<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
    <title>Munch On Lunch – Menu</title>
    <link rel="icon" href="images/logo.png">
    <meta name="color-scheme" content="light only"/>
    <meta property="og:title" content="Munch On Lunch – Menu">
    <meta property="og:description" content="Xem menu và đặt bánh ngon từ Munch On Lunch!">
    <meta property="og:image" content="https://menu.eaglevee.com/images/logo.png">
    <meta property="og:url" content="https://menu.eaglevee.com">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Munch On Lunch – Menu">
    <meta name="twitter:description" content="Xem menu và đặt bánh ngon từ Munch On Lunch!">
    <meta name="twitter:image" content="https://menu.eaglevee.com/images/logo.png">
    <link rel="stylesheet" href="assets/styles.css">
</head>
<body>
<header class="site-header">
    <div class="container row">
        <h1 class="logo">MUNCH ON LUNCH</h1>
        <nav>
            <a href="index.html" aria-current="page">Menu</a>
            <!--            <a href="feedback.html">Feedbacks</a>-->
        </nav>
    </div>
</header>

<main class="sheet" role="main">
    <!-- Menu -->
    <div class="section-title">MENU</div>
    <table class="menu-table" aria-label="Menu chính">
        <colgroup>
            <col class="col-name">
            <col class="col-half">
            <col class="col-full">
        </colgroup>
        <thead>
        <tr>
            <th></th>
            <th>Nửa</th>
            <th>Full</th>
        </tr>
        </thead>
        <tbody id="menu-body"></tbody>
    </table>

    <!-- Extra -->
    <div class="section-title" style="margin-top:1.8rem;">EXTRA</div>
    <table class="extra-table" aria-label="Topping thêm">
        <colgroup>
            <col class="col-name">
            <col class="col-full">
        </colgroup>
        <tbody id="extra-body"></tbody>
    </table>

    <!-- Notes -->
    <div class="section-title" style="margin-top:2rem;">NOTE</div>
    <div class="notes">
        <ul id="notes-list"></ul>
    </div>
</main>

<!-- Lightbox -->
<div id="lightbox" class="lightbox" aria-hidden="true">
    <button class="lightbox__backdrop" aria-label="Đóng"></button>
    <img id="lightbox-img" alt="">
</div>

<script>
    // Lightbox helpers
    const lightbox = document.getElementById('lightbox');
    const lightboxImg = document.getElementById('lightbox-img');

    function openLightbox(src, alt = '') {
        lightboxImg.src = src;
        lightboxImg.alt = alt;
        lightbox.classList.add('open');
        lightbox.setAttribute('aria-hidden', 'false');
        document.body.style.overflow = 'hidden';
    }

    function closeLightbox() {
        lightbox.classList.remove('open');
        lightbox.setAttribute('aria-hidden', 'true');
        lightboxImg.src = '';
        document.body.style.overflow = '';
    }

    lightbox.addEventListener('click', (e) => {
        if (e.target.classList.contains('lightbox__backdrop')) closeLightbox();
    });
    window.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeLightbox();
    });

    function createMenuRow(item, idx) {
        const tr = document.createElement('tr');
        tr.dataset.row = idx;

        const tdName = document.createElement('td');

        const line = document.createElement('div');
        line.className = 'item-line' + (item.bold ? ' bold' : '');

        if (item.images && item.images.length) {
            const btn = document.createElement('button');
            btn.type = 'button';
            btn.className = 'disclose';
            btn.setAttribute('aria-expanded', 'false');
            btn.setAttribute('aria-controls', `gallery-${idx}`);
            btn.addEventListener('click', () => toggleGallery(idx, btn));

            const caret = document.createElement('span');
            caret.className = 'caret';

            const name = document.createElement('span');
            name.className = 'name';
            name.textContent = item.name;

            btn.append(caret, name);
            line.append(btn);
        } else {
            const name = document.createElement('span');
            name.className = 'name';
            name.textContent = item.name;
            line.append(name);
        }

        const fill = document.createElement('span');
        fill.className = 'fill';
        line.append(fill);

        tdName.appendChild(line);

        const tdHalf = document.createElement('td');
        tdHalf.className = 'menu-price';
        tdHalf.textContent = item.half;

        const tdFull = document.createElement('td');
        tdFull.className = 'menu-price';
        tdFull.textContent = item.full;

        tr.append(tdName, tdHalf, tdFull);
        return tr;
    }

    function createGalleryRow(item, idx) {
        const tr = document.createElement('tr');
        tr.className = 'gallery-row';
        tr.dataset.galleryFor = idx;
        tr.id = `gallery-${idx}`;
        tr.hidden = true;

        const td = document.createElement('td');
        td.colSpan = 3;

        const grid = document.createElement('div');
        grid.className = 'gallery';

        (item.images || []).forEach((src) => {
            const btn = document.createElement('button');
            btn.type = 'button';
            btn.className = 'thumb';

            const img = document.createElement('img');
            img.loading = 'lazy';
            img.src = src;               // replace with your real paths
            img.alt = item.name;

            btn.appendChild(img);
            btn.addEventListener('click', () => openLightbox(src, item.name));
            grid.appendChild(btn);
        });

        td.appendChild(grid);
        tr.appendChild(td);
        return tr;
    }

    function toggleGallery(idx, controlBtn) {
        const row = document.querySelector(`tr.gallery-row[data-gallery-for="${idx}"]`);
        const expanded = controlBtn.getAttribute('aria-expanded') === 'true';
        const nextState = !expanded;

        controlBtn.setAttribute('aria-expanded', String(nextState));
        row.hidden = !nextState;
    }

    function createExtraRow(extra) {
        const tr = document.createElement("tr");

        const tdName = document.createElement("td");
        const line = document.createElement("div");
        line.className = "item-line";
        const name = document.createElement("span");
        name.className = "name";
        name.textContent = extra.name;
        const fill = document.createElement("span");
        fill.className = "fill";
        line.append(name, fill);
        tdName.appendChild(line);

        const tdFull = document.createElement("td");
        tdFull.className = "menu-price";
        tdFull.textContent = extra.price;

        tr.append(tdName, tdFull);
        return tr;
    }

    function createNoteItem(note) {
        const li = document.createElement('li');
        li.innerHTML = note.replace(/\*(.*?)\*/g, "<strong>$1</strong>");
        return li;
    }

    // Load data
    async function init() {
        const res = await fetch('data/menu.json');
        const data = await res.json();
        const menuBody = document.getElementById('menu-body');
        const extraBody = document.getElementById('extra-body');
        const notesList = document.getElementById('notes-list');

        data.menu.forEach((item, idx) => {
            menuBody.appendChild(createMenuRow(item, idx));
            if (item.images && item.images.length) {
                menuBody.appendChild(createGalleryRow(item, idx));
            }
        });

        data.extras.forEach(extra => extraBody.appendChild(createExtraRow(extra)));
        data.notes.forEach(n => notesList.appendChild(createNoteItem(n)));
    }

    init().catch(console.error);
</script>
</body>
</html>
